<!doctype html>
<html lang="ar" dir="rtl" data-theme="light">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>حاسبة القسط الشهري</title>
<style>
  :root{
    --bg:#f6f7f9; --card:#ffffff; --ink:#0f172a; --sub:#475569; --border:#e2e8f0;
    --accent:#2563eb; --accent-600:#1d4ed8; --shadow:0 12px 32px rgba(2,6,23,.08);
    --orange:#fde3cf; --blue:#cfe8ff; --gray:#f3f4f6; --header:#e8f4ff;
    --ok:#16a34a; --err:#dc2626;
  }
  [data-theme="dark"]{
    --bg:#0b1220; --card:#101827; --ink:#e5e7eb; --sub:#9aa4b2; --border:#1f2a3a;
    --accent:#60a5fa; --accent-600:#3b82f6; --shadow:0 18px 40px rgba(0,0,0,.35);
    --orange:#5a3c22; --blue:#16324f; --gray:#0f172a; --header:#0d2238;
    --ok:#22c55e; --err:#ef4444;
  }
  *{box-sizing:border-box}
  body{font-family:system-ui,-apple-system,"Segoe UI",Tahoma,Arial;background:var(--bg);margin:0;color:var(--ink);-webkit-text-size-adjust:100%}
  .wrap{max-width:980px;margin:24px auto;padding:0 16px}
  .btn{background:var(--accent);color:#fff;border:none;padding:12px 16px;border-radius:12px;cursor:pointer;font-weight:700;font-size:14px;box-shadow:var(--shadow)}
  .btn.secondary{background:transparent;color:var(--ink);border:1px solid var(--border)}
  .btn.full{width:100%}
  .card{background:var(--card);border:1px solid var(--border);border-radius:16px;overflow:hidden;box-shadow:var(--shadow);margin-bottom:16px}
  .head{background:var(--header);padding:12px 16px;font-weight:800}
  .section{padding:16px}
  /* شبكة مرنة: 1 عمود (موبايل) / 2 أعمدة (متوسطة) / 3 أعمدة (كبيرة) */
  .grid{display:grid;gap:12px;grid-template-columns:1fr}
  @media (min-width:640px){ .grid{grid-template-columns:repeat(2, minmax(220px,1fr));} }
  @media (min-width:900px){ .grid{grid-template-columns:repeat(3, minmax(220px,1fr));} }
  .field{display:flex;flex-direction:column;gap:6px;min-width:0}
  .label{font-size:13px;color:var(--sub)}
  input,select{
    width:100%;padding:14px 16px;font-size:16px;border:1px solid var(--border);
    border-radius:12px;background:#fff;min-width:0;line-height:1.2; height:48px;
  }
  [data-theme="dark"] input,[data-theme="dark"] select{background:#0b1220;color:var(--ink)}
  input.in-orange{background:var(--orange)}
  input.in-blue{background:var(--blue)}
  input[readonly]{background:var(--gray)}
  /* إزالة أسهم الأرقام */
  input[type=number]::-webkit-outer-spin-button,
  input[type=number]::-webkit-inner-spin-button{ -webkit-appearance:none; margin:0;}
  input[type=number]{ -moz-appearance:textfield; }
  /* KPIs */
  .kpi{display:grid;gap:10px;grid-template-columns:1fr}
  @media (min-width:640px){ .kpi{grid-template-columns:repeat(3,1fr);} }
  .pill{border:1px dashed var(--border);border-radius:12px;padding:12px 14px;font-size:14px}
  .pill b{display:block;font-size:18px;margin-top:6px}
  /* Toast */
  .toast{position:fixed;inset-inline-start:50%;transform:translateX(-50%);bottom:20px;background:#111;color:#fff;padding:10px 14px;border-radius:10px;opacity:0;pointer-events:none;transition:.25s ease;font-size:14px}
  .toast.show{opacity:.95;bottom:28px}
</style>
</head>
<body>
<div class="wrap">
  <!-- بطاقة المدخلات -->
  <div class="card">
    <div class="head">المدخلات</div>
    <div class="section grid">
      <div class="field"><div class="label">قيمة العقار</div><input id="price" class="in-orange" type="text" inputmode="numeric" placeholder="1,000,000"></div>
      <div class="field"><div class="label">مدة التمويل</div>
        <select id="years" class="in-orange">
          <option value="20">20 سنة</option><option value="25" selected>25 سنة</option><option value="30">30 سنة</option>
        </select>
      </div>
      <div class="field"><div class="label">نسبة البنك %</div><input id="rate" class="in-blue" type="number" step="0.01" min="0" value="3.50"></div>
      <div class="field"><div class="label">طريقة الحساب</div>
        <select id="method" class="in-orange">
          <option value="simple">فائدة بسيطة</option><option value="amortized" selected>قياسية (EMI)</option>
        </select>
      </div>
      <div class="field"><div class="label">الدفعة الأولى (مبلغ)</div><input id="downAmt" class="in-orange" type="text" inputmode="numeric" placeholder="100,000"></div>
      <div class="field"><div class="label">أصل القرض بعد الدفعة</div><input id="principal" type="text" readonly></div>
    </div>

    <div class="section">
      <div class="kpi">
        <div class="pill">إجمالي الفائدة<b id="totalInterest">—</b></div>
        <div class="pill">إجمالي المبلغ<b id="totalPayable">—</b></div>
        <div class="pill">القسط الشهري<b id="monthly">—</b></div>
      </div>
      <div style="margin-top:12px"><button id="copy" class="btn full">نسخ الملخص</button></div>
    </div>
  </div>

  <!-- بطاقة نسبة القسط من الراتب -->
  <div class="card">
    <div class="head">نسبة القسط من الراتب</div>
    <div class="section grid">
      <div class="field"><div class="label">الراتب الشهري</div><input id="salary" class="in-orange" type="text" inputmode="numeric" placeholder="10,000"></div>
      <div class="field"><div class="label">النسبة المستهدفة %</div><input id="pct" class="in-blue" type="number" step="0.1" min="0" max="100" value="35"></div>
      <div class="field"><div class="label">الحد المسموح</div><input id="afford" type="text" readonly></div>
    </div>
    <div class="section">
      <div class="kpi">
        <div class="pill">هل القسط ضمن الحد؟<b id="fit">—</b></div>
        <div class="pill">الفرق عن الحد<b id="delta">—</b></div>
        <div class="pill">نسبة القسط من الراتب<b id="actualPct">—</b></div>
      </div>
    </div>
  </div>
</div>

<div id="toast" class="toast">تم النسخ ✅</div>

<script>
/* تنسيق مدخلات الأرقام بالفواصل */
function formatInput(id){
  const el=document.getElementById(id);
  el.addEventListener('input',()=>{
    let raw=(el.value||'').replace(/,/g,'').replace(/[^\d]/g,'');
    el.value = raw ? Number(raw).toLocaleString('en-US') : '';
    calc();
  });
}
['price','downAmt','salary'].forEach(formatInput);

function getNumber(id){return parseFloat((document.getElementById(id).value||'').replace(/,/g,''))||0;}
function fmt(v,d=2){return isNaN(v)||!isFinite(v)?"—":new Intl.NumberFormat('en-US',{minimumFractionDigits:d,maximumFractionDigits:d}).format(v);}

function buildSummary(){
  return [
    `قيمة العقار: ${fmt(getNumber('price'))} ريال`,
    `أصل القرض: ${document.getElementById('principal').value||'—'} ريال`,
    `القسط الشهري: ${document.getElementById('monthly').textContent||'—'} ريال`,
    `إجمالي الفائدة: ${document.getElementById('totalInterest').textContent||'—'} ريال`,
    `إجمالي المبلغ: ${document.getElementById('totalPayable').textContent||'—'} ريال`
  ].join('\n');
}
function showToast(msg='تم النسخ ✅'){const t=document.getElementById('toast');t.textContent=msg;t.classList.add('show');setTimeout(()=>t.classList.remove('show'),1800);}
async function copySummary(){try{await navigator.clipboard.writeText(buildSummary());showToast();}catch(e){const ta=document.createElement('textarea');ta.value=buildSummary();document.body.appendChild(ta);ta.select();document.execCommand('copy');document.body.removeChild(ta);showToast();}}

function calc(){
  const price=getNumber('price');
  const downAmt=getNumber('downAmt');
  const principal=Math.max(0, price - downAmt);
  document.getElementById('principal').value = principal ? fmt(principal) : '';

  const R=(parseFloat(document.getElementById('rate').value)||0)/100;
  const years=parseFloat(document.getElementById('years').value)||0;
  const months=years*12;
  const method=document.getElementById('method').value;

  let totalInterest=0,totalPayable=0,monthly=0;
  if(principal>0 && years>0){
    if(method==='simple'){
      totalInterest=principal*R*years; totalPayable=principal+totalInterest; monthly=totalPayable/months;
    }else{
      const rm=R/12;
      if(rm===0){ monthly=principal/months; }
      else{ const pow=Math.pow(1+rm,months); monthly=principal*rm*pow/(pow-1); }
      totalPayable=monthly*months; totalInterest=totalPayable-principal;
    }
  }
  document.getElementById('totalInterest').textContent=fmt(totalInterest);
  document.getElementById('totalPayable').textContent=fmt(totalPayable);
  document.getElementById('monthly').textContent=fmt(monthly);

  // نسبة القسط من الراتب
  const salary=getNumber('salary'), pct=(parseFloat(document.getElementById('pct').value)||0)/100;
  const afford=salary*pct; document.getElementById('afford').value=afford?fmt(afford):'';
  const fitEl=document.getElementById('fit');
  if(monthly>0 && afford>0){
    const delta=afford-monthly, actualPct=(monthly/(salary||1))*100;
    fitEl.textContent=delta>=0?'نعم':'لا'; fitEl.style.color=delta>=0?'green':'red';
    document.getElementById('delta').textContent=fmt(delta);
    document.getElementById('actualPct').textContent=fmt(actualPct,2)+'%';
  }else{
    fitEl.textContent='—'; fitEl.style.color='';
    document.getElementById('delta').textContent='—';
    document.getElementById('actualPct').textContent='—';
  }
}

/* أحداث */
['years','rate','method','pct'].forEach(id=>document.getElementById(id).addEventListener('input',calc));
document.getElementById('copy').addEventListener('click',copySummary);
/* تشغيل أولي */
calc();
</script>
</body>
</html>